<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Calendrier.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Calendrier.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Module de gestion de l'interface du calendrier fullcalendar
 * @module Calendrier
 */
define(["RestManager", "lib/fullcalendar.translated.min"], function(RestManager) {

	/**
	 * @constructor
	 * @alias module:Calendrier
	 */
	var Calendrier = function(eventsSource, ajoutEvenement) {
		var me = this;

		this.jqCalendar = $("#calendar");
		// Initialisation du calendrier
		this.jqCalendar.fullCalendar({
			weekNumbers: true,
			weekNumberTitle: "Sem.",
			firstDay: 1,
			editable: true,
			defaultView: "agendaWeek",
			timeFormat: "HH'h'(mm)",
			axisFormat: "HH'h'(mm)",
			titleFormat: {
				month: 'MMMM yyyy',                             // Septembre 2013
				week: "d [ MMM] [ yyyy] '&ndash;' {d MMM yyyy}", // 7 - 13 Sep 2013
				day: 'dddd d MMM yyyy'                  // Mardi 8 Sep 2013
			},
			columnFormat: {
				month: 'ddd',    // Lun
				week: 'ddd d/M', // Lun 7/9
				day: 'dddd d/M'  // Lundi 7/9
			},
			header: {
				right: '',
				center: 'title',
				left: 'prev,next today month,agendaWeek,agendaDay'
			},
			height: Math.max(window.innerHeight - 110, 500),
			windowResize: function(view) {
				me.jqCalendar.fullCalendar("option", "height", Math.max(window.innerHeight - 110, 500));
			},
			events: eventsSource,
			dayClick: function(date, allDay, jsEvent, view) {
				
				// Durée d'1h par défaut
				var dateFin = new Date(date.getTime() + 1000 * 3600);
				
				ajoutEvenement.show(date, dateFin, null);
			}
		});
		
		// Ajout des listeners d'évènements aux dropdown de filtres
		var updateFiltres = function() { me.refetchEvents(); };
		$("#dropdown_filtre_matiere").change(updateFiltres);
		$("#dropdown_filtre_type").change(updateFiltres);
		$("#dropdown_filtre_responsable").change(updateFiltres);
	};
	
	

	/**
	 * Rafraichit le calendrier
	 */
	Calendrier.prototype.refetchEvents = function() {
		this.jqCalendar.fullCalendar("refetchEvents");
	};
	
	/**
	 * Remplit une liste déroulante avec les clés/valeurs de l'objet fourni
	 */
	var remplirDropdown = function(jqDropdown, objValues) {
		var currentValue = jqDropdown.val();
		
		jqDropdown.find("option").remove();
		// Ajout d'un élément sans filtre
		jqDropdown.append("&lt;option value=''>---&lt;/option>");
		var found = false;
		for(var key in objValues) {
			if(key == currentValue) {
				found = true;
				jqDropdown.append("&lt;option selected='selected' value='" + key + "'>" + objValues[key] + "&lt;/option>");
			}
			else {
				jqDropdown.append("&lt;option value='" + key + "'>" + objValues[key] + "&lt;/option>");
			}
		}
		
		if(!found) {
			jqDropdown.val('');
		}
	};

	
	/**
	 * Filtre les évènements en fonction des filtres sélectionnés,
	 * et remplit les listes déroulantes des filtres en fonction des évènements à afficher
	 * @param evenements
	 */
	Calendrier.prototype.filtrerMatiereTypeRespo = function(evenements) {
		// Récupération des filtres sélectionnés
		var jqFiltreMatiere = $("#dropdown_filtre_matiere");
		var jqFiltreType = $("#dropdown_filtre_type");
		var jqFiltreRespo = $("#dropdown_filtre_responsable");
		
		var filtreMatiere = jqFiltreMatiere.val();
		var filtreType = jqFiltreType.val();
		var filtreRespo = jqFiltreRespo.val();
		
		var matieres = Object(); // Clés et valeurs : nom de la matière
		var types = Object(); // Clés et valeurs : type
		var responsables = Object(); // Clé : id, valeur : prénom nom

		var res = new Array();
		
		for(var i=0, maxI = evenements.length; i&lt;maxI; i++) {
			var okMatiere = false;
			for(var j=0, maxJ = evenements[i].matieres.length; j&lt;maxJ; j++) {
				var matiere = evenements[i].matieres[j];
				matieres[matiere] = matiere;
				
				if(matiere == filtreMatiere) {
					okMatiere = true;
				}
			}
			
			var okType = false;
			for(var j=0, maxJ = evenements[i].types.length; j&lt;maxJ; j++) {
				var type = evenements[i].types[j];
				types[type] = type;
				
				if(type == filtreType) {
					okType = true;
				}
			}
			
			var okRespo = false;
			for(var j=0, maxJ = evenements[i].responsables.length; j&lt;maxJ; j++) {
				var respo = evenements[i].responsables[j];
				responsables[respo.id] = respo.prenom + " " + respo.nom;
				
				if(respo.id == filtreRespo) {
					okRespo = true;
				}
			}
			
			// Filtrage de l'évènement
			if((!filtreMatiere || okMatiere) && (!filtreType || okType) && (!filtreRespo || okRespo)) {
				res.push(evenements[i]);
			}
		}
		
		// Remplissage des listes déroulantes
		remplirDropdown(jqFiltreMatiere, matieres);
		remplirDropdown(jqFiltreType, types);
		remplirDropdown(jqFiltreRespo, responsables);
		
		return res;
	};

	return Calendrier;
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-AjoutEvenement.html">AjoutEvenement</a></li><li><a href="module-Calendrier.html">Calendrier</a></li><li><a href="module-CalendrierGestion.html">CalendrierGestion</a></li><li><a href="module-DialogConnexion.html">DialogConnexion</a></li><li><a href="module-DialogCreationCalendrier.html">DialogCreationCalendrier</a></li><li><a href="module-DialogCreationGroupeParticipants.html">DialogCreationGroupeParticipants</a></li><li><a href="module-EcranAccueil.html">EcranAccueil</a></li><li><a href="module-EcranParametres.html">EcranParametres</a></li><li><a href="module-EvenementGestion.html">EvenementGestion</a></li><li><a href="module-GroupeGestion.html">GroupeGestion</a></li><li><a href="module-ListeGroupesParticipants.html">ListeGroupesParticipants</a></li><li><a href="module-RechercheSalle.html">RechercheSalle</a></li><li><a href="module-RestManager.html">RestManager</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Nov 08 2013 18:52:10 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
